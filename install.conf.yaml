- defaults:
    link:
      create: true
      relink: true

- clean: ['~']

- link:
    ~/.profile:
        path: profile
        force: true
    ~/.vimrc: vimrc
    ~/.zshrc:
        path: zshrc
        force: true
    ~/.config/nvim:
      path: nvim
      force: true
    ~/.config/starship.toml: starship.toml 
    ~/.tmux.conf:
        path: tmux
        force: true
    ~/.zsh_plugins.txt: zsh_plugins.txt
    ~/.wezterm.lua: wezterm.lua
    ~/Library/Application Support/nushell/config.nu:
      path: nushell/config.nu
      force: true
    ~/Library/Application Support/nushell/env.nu:
      path: nushell/env.nu
      force: true
    ~/.config/nushell/config.nu:
      path: nushell/config.nu
      force: true
    ~/.config/nushell/env.nu:
      path: nushell/env.nu
      force: true
    ~/.config/zellij:
      path: zellij
      force: true
    ~/.termux/termux.properties:
      path: termux.properties
      force: true


- shell:
    - command:
        command -v rustup >/dev/null 2>&1 ||
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable
      description: Install Rust toolchain
      quiet: false
    - command:
        rustup update stable
      description: Update Rust to latest stable version
      quiet: false
    # Install cargo packages
    - command: |
          cargo install fd-find bat ripgrep starship atuin zoxide eza bottom du-dust just trippy pueue gitui bandwhich procs yazi-fm navi tlrc git-delta
      description: Install cargo packages
      quiet: false
    # Install essential CLI tools via package manager
    - command: |
        bash -c '
        PACKAGES="fzf jq yq direnv htop"
        MISSING=""
        for pkg in $PACKAGES; do
          if ! command -v $pkg >/dev/null 2>&1; then
            MISSING="$MISSING $pkg"
          fi
        done
        MISSING=$(echo $MISSING | xargs)
        if [ -n "$MISSING" ]; then
          echo "Installing missing packages: $MISSING"
          if command -v apt-get >/dev/null 2>&1; then
            sudo apt-get update && sudo apt-get install -y $MISSING
          elif command -v pacman >/dev/null 2>&1; then
            sudo pacman -S --noconfirm $MISSING
          elif command -v brew >/dev/null 2>&1; then
            brew install $MISSING
          else
            echo "No supported package manager found"
          fi
        else
          echo "All essential packages already installed"
        fi
        '
      description: Install essential CLI tools
      quiet: false
    # Install thefuck
    - command:
        command -v thefuck >/dev/null 2>&1 ||
        (command -v pipx >/dev/null 2>&1 && pipx install thefuck) ||
        (command -v apt-get >/dev/null 2>&1 && sudo apt-get install -y python3-thefuck) ||
        pip install thefuck --user --break-system-packages 2>/dev/null ||
        echo "Skipping thefuck (could not install)"
      description: Install thefuck
      quiet: false
    - command:
        test -f ~/.zoxide.nu ||
        zoxide init nushell > ~/.zoxide.nu
      description: Setup zoxide integration
      quiet: false
    # Install intelli-shell
    - command:
        command -v intelli-shell >/dev/null 2>&1 ||
        curl -sSf https://raw.githubusercontent.com/lasantosr/intelli-shell/main/install.sh | INTELLI_SKIP_PROFILE=1 sh
      description: Install intelli-shell
      quiet: false
    # Fix intelli-shell Nushell compatibility
    - command: |
        INTELLI_FILE=~/.local/share/nushell/vendor/autoload/intelli-shell.nu
        if [ -f "$INTELLI_FILE" ]; then
          sed -i 's/commandline edit --replace \$command_out --accept/commandline edit --replace $command_out/' "$INTELLI_FILE"
        fi
      description: Fix intelli-shell Nushell compatibility
      quiet: false
    - command:
        test -f ~/.gitconfig &&
        ! grep -q '~/.dotfiles/gitconfig' ~/.gitconfig &&
        echo -e '[include]\n  path = "~/.dotfiles/gitconfig"' >> ~/.gitconfig ||
        true
      description: Include custom gitconfig into global gitconfig
      quiet: false
    - command:
        cd ~/.dotfiles/argc-completions &&
        (./scripts/download-tools.sh --force 2>/dev/null || echo "argc download failed, skipping") &&
        (./scripts/setup-shell.sh nushell 2>/dev/null || echo "argc setup failed, skipping")
      description: Init argc-completion
      quiet: false
    - command:
        test -f ~/.local/share/atuin/init.nu ||
        (mkdir -p ~/.local/share/atuin &&
        atuin init --disable-up-arrow nu > ~/.local/share/atuin/init.nu)
      description: Setup atuin
      quiet: false
    # Install git-secrets
    - command:
        command -v git-secrets >/dev/null 2>&1 ||
        (git clone https://github.com/awslabs/git-secrets /tmp/git-secrets &&
        cd /tmp/git-secrets && make install PREFIX=~/.local &&
        rm -rf /tmp/git-secrets)
      description: Install git-secrets
      quiet: false
    # Setup git-secrets globally for all repos
    - command:
        test -d ~/.git-templates/git-secrets ||
        (git secrets --register-aws --global 2>/dev/null || true &&
        mkdir -p ~/.git-templates/git-secrets &&
        git secrets --install ~/.git-templates/git-secrets 2>/dev/null || true &&
        git config --global init.templateDir ~/.git-templates/git-secrets)
      description: Configure git-secrets globally
      quiet: false
    # Install git-secrets hooks in dotfiles repo
    - command:
        cd ~/.dotfiles &&
        git secrets --install 2>/dev/null || true &&
        git secrets --register-aws 2>/dev/null || true
      description: Install git-secrets in dotfiles repo
      quiet: false
    # Install git-extras via package manager
    - command: >
        command -v git-summary >/dev/null 2>&1 ||
        (if command -v apt-get >/dev/null 2>&1; then
          sudo apt-get update && sudo apt-get install -y git-extras;
        elif command -v pacman >/dev/null 2>&1; then
          sudo pacman -S --noconfirm git-extras;
        elif command -v brew >/dev/null 2>&1; then
          brew install git-extras;
        else
          echo "Skipping git-extras (no supported package manager)";
        fi)
      description: Install git-extras
      quiet: false
    # Install git-stats (requires Node.js/npm)
    - command:
        command -v npm >/dev/null 2>&1 &&
        (npm list -g git-stats >/dev/null 2>&1 || npm install -g git-stats) ||
        echo "Skipping git-stats (npm not found)"
      description: Install git-stats
      quiet: false
    # Install commitizen (requires Node.js/npm)
    - command:
        command -v npm >/dev/null 2>&1 &&
        (npm list -g commitizen >/dev/null 2>&1 || npm install -g commitizen cz-conventional-changelog) ||
        echo "Skipping commitizen (npm not found)"
      description: Install commitizen
      quiet: false

