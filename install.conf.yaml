- defaults:
    link:
      create: true
      relink: true

- clean: ['~']

- link:
    ~/.profile:
        path: profile
        force: true
    ~/.vimrc: vimrc
    ~/.zshrc:
        path: zshrc
        force: true
    ~/.config/nvim:
      path: nvim
      force: true
    ~/.config/starship.toml: starship 
    ~/.tmux.conf:
        path: tmux
        force: true
    ~/.config/alacritty/alacritty.toml:
      path: alacritty.toml
      force: true
    ~/.zsh_plugins.txt: zsh_plugins.txt
    ~/.wezterm.lua: wezterm.lua
    ~/Library/Application Support/nushell/config.nu:
      path: config.nu
      force: true
    ~/Library/Application Support/nushell/env.nu:
      path: env.nu
      force: true
    ~/.config/nushell/config.nu:
      path: config.nu
      force: true
    ~/.config/nushell/env.nu:
      path: env.nu
      force: true
    ~/.config/zellij:
      path: zellij
      force: true
    ~/.termux/termux.properties:
      path: termux.properties
      force: true


- shell:
    # Install Rust if not present
    - command:
        command -v rustup >/dev/null 2>&1 ||
        curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable
      description: Install Rust toolchain
      quiet: true
    - command:
        rustup update stable
      description: Update Rust to latest stable version
      quiet: true
    - command:
        cargo install fd-find bat ripgrep starship atuin zoxide eza bottom du-dust just trippy pueue gitui bandwhich procs intelli-shell yazi-build navi tlrc
      description: Install cargo packages
      quiet: true
    - command:
        mkdir -p ~/.local/share/nushell/vendor/autoload &&
        intelli-shell init nushell > ~/.local/share/nushell/vendor/autoload/intelli-shell.nu
      description: Setup intelli-shell
      quiet: true
    - command:
        test -d "${HOME}/.local/bin/diff-so-fancy" ||
        git clone https://github.com/so-fancy/diff-so-fancy ~/.local/bin/diff-so-fancy
      description: Install diff-so-fancy
      quiet: true
    - command:
        which starship || sh -c "$(curl -fsSL https://starship.rs/install.sh)" -s '-f' >/dev/null 2>&1
      description: Install starship
      quiet: true
    - command:
        test -d "${HOME}/.zoxide.nu" ||
        zoxide init nushell > ~/.zoxide.nu
      description: Setup zoxide
      quiet: true
    - command:
        test -f ~/.gitconfig &&
        ! grep -q '~/.dotfiles/gitconfig' ~/.gitconfig &&
        echo -e '[include]\n  path = "~/.dotfiles/gitconfig"' >> ~/.gitconfig ||
        true
      description: Include custom gitconfig into global gitconfig
      quiet: true
    - command:
        cd ~/.dotfiles/argc-completions &&
        ./scripts/download-tools.sh --force
      description: Init argc-completion
      quiet: true
    - command:
        test -d "${HOME}/.local/share/atuin" ||
        mkdir ~/.local/share/atuin/ &&
        atuin init --disable-up-arrow nu > ~/.local/share/atuin/init.nu
      description: Setup atuin
      quiet: true
    # Install git-secrets
    - command:
        command -v git-secrets >/dev/null 2>&1 ||
        (git clone https://github.com/awslabs/git-secrets /tmp/git-secrets &&
        cd /tmp/git-secrets && make install PREFIX=~/.local &&
        rm -rf /tmp/git-secrets)
      description: Install git-secrets
      quiet: true
    # Setup git-secrets globally for all repos
    - command:
        git secrets --register-aws --global 2>/dev/null || true &&
        mkdir -p ~/.git-templates/git-secrets &&
        git secrets --install ~/.git-templates/git-secrets 2>/dev/null || true &&
        git config --global init.templateDir ~/.git-templates/git-secrets
      description: Configure git-secrets globally
      quiet: true
    # Install git-secrets hooks in dotfiles repo
    - command:
        cd ~/.dotfiles &&
        git secrets --install 2>/dev/null || true &&
        git secrets --register-aws 2>/dev/null || true
      description: Install git-secrets in dotfiles repo
      quiet: true

